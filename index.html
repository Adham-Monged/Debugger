<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1TEGWZMZ0W"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1TEGWZMZ0W');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Debugger - Beginner-Friendly JavaScript Debugging Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
    --primary-color: #4361ee;
    --secondary-color: #3a0ca3;
    --error-color: #e63946;
    --warning-color: #ff9e00;
    --success-color: #2a9d8f;
    --light-color: #f8f9fa;
    --dark-color: #212529;
    --gray-color: #6c757d;
    --light-gray: #e9ecef;
    --border-radius: 8px;
    --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
}

body {
    background-color: #f5f7ff;
    color: var(--dark-color);
    transition: background-color 0.4s ease, color 0.4s ease;
}

[data-theme="dark"] {
    --primary-color: #5e81f4;
    --secondary-color: #b392f0;
    --error-color: #ff6b6b;
    --warning-color: #ffd43b;
    --success-color: #51cf66;
    --light-color: #212529;
    --dark-color: #f8f9fa;
    --gray-color: #adb5bd;
    --light-gray: #343a40;
    background-color: #121212;
    color: #e9ecef;
}

[data-theme="dark"] body {
    background-color: #0d0d0d;
    color: #e0e0e0;
}

[data-theme="dark"] .container > * {
    background-color: #1e1e1e;
}

[data-theme="dark"] .input-section,
[data-theme="dark"] .output-section,
[data-theme="dark"] .feedback-section,
[data-theme="dark"] header {
    background-color: #1e1e1e;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .code-input,
[data-theme="dark"] .example-code,
[data-theme="dark"] .fix-code {
    background-color: #121212 !important;
    color: #f8f8f2 !important;
}

[data-theme="dark"] .line-numbers {
    background-color: #121212;
    color: #666;
}

[data-theme="dark"] .code-input-container {
    background: #121212;
    border-color: #333;
}

[data-theme="dark"] .output-placeholder {
    color: #888;
}

[data-theme="dark"] .btn-secondary {
    background-color: #2d2d2d;
    color: #e0e0e0;
}

[data-theme="dark"] .btn-secondary:hover {
    background-color: #3a3a3a;
}

[data-theme="dark"] .example-code,
[data-theme="dark"] .suggested-fix pre,
[data-theme="dark"] .fix-code {
    background-color: #1e1e1e !important;
    color: #f8f8f2 !important;
}

/* Improved Dark Mode for Cards, Code, and Feedback */
[data-theme="dark"] .error-card {
    background-color: #2d2d2d;
    border-left-color: var(--error-color); /* Keeps red/orange border */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .error-card.warning {
    border-left-color: var(--warning-color);
}

[data-theme="dark"] .error-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    background-color: #333333;
}

[data-theme="dark"] .error-title,
[data-theme="dark"] .error-explanation,
[data-theme="dark"] .detail-title,
[data-theme="dark"] .detailed-explanation,
[data-theme="dark"] .suggested-fix {
    color: #e0e0e0;
}

[data-theme="dark"] .error-location,
[data-theme="dark"] .error-severity {
    color: #bbbbbb;
}

[data-theme="dark"] .issues-badge {
    background-color: #3a3a3a;
    color: #e0e0e0;
}

[data-theme="dark"] .issues-badge.error {
    background-color: rgba(255, 107, 107, 0.2);
    color: var(--error-color);
}

[data-theme="dark"] .issues-badge.warning {
    background-color: rgba(255, 212, 59, 0.2);
    color: var(--warning-color);
}

/* Code blocks in suggested fix - better contrast */

[data-theme="dark"] .fix-code,
[data-theme="dark"] .example-code {
    background-color: #1e1e1e !important;
    color: #f8f8f2 !important;
    border: 1px solid #444;
}


/* Fix code - green highlight */
[data-theme="dark"] .fix-code {
    color: #51cf66 !important;
}

/* Input areas */
[data-theme="dark"] .code-input,
[data-theme="dark"] .feedback-input {
    background-color: #1e1e1e;
    color: #f8f8f2;
    border-color: #444;
}

[data-theme="dark"] .code-input:focus,
[data-theme="dark"] .feedback-input:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(94, 129, 244, 0.3);
}

/* Placeholder text */
[data-theme="dark"] .output-placeholder {
    color: #888;
}

[data-theme="dark"] .output-placeholder i {
    color: #555;
}

/* Buttons in dark mode */
[data-theme="dark"] .btn-primary {
    background-color: var(--primary-color);
}

[data-theme="dark"] .btn-primary:hover {
    background-color: var(--secondary-color);
}

/* Feedback section specific */
[data-theme="dark"] .feedback-section p {
    color: #aaa;
}

/* Scrollbars in dark mode */
[data-theme="dark"] ::-webkit-scrollbar-track {
    background: #1e1e1e;
}

[data-theme="dark"] ::-webkit-scrollbar-thumb {
    background: #555;
}

[data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
    background: #777;
}

/* === PERFECT CARD INTERIOR FOR BOTH LIGHT & DARK MODE === */

/* Base card text colors */
.error-card .error-title {
    color: var(--dark-color);
    font-weight: 600;
}

.error-card .error-explanation {
    color: var(--gray-color);
}

.error-card .error-location {
    color: var(--gray-color);
}

/* Dark mode overrides for card content */
[data-theme="dark"] .error-card .error-title {
    color: #f8f9fa;
}

[data-theme="dark"] .error-card .error-explanation {
    color: #ced4da;
}

[data-theme="dark"] .error-card .error-location {
    color: #adb5bd;
}

[data-theme="dark"] .detail-title {
    color: #b392f0; /* Slightly purple accent for headings */
}

[data-theme="dark"] .detailed-explanation,
[data-theme="dark"] .suggested-fix {
    color: #e0e0e0;
    background-color: #252525;
    border-radius: var(--border-radius);
}


/* "Fix" code block */
[data-theme="dark"] .fix-code {
    background-color: #1e2b1e !important;
    color: #a8e6a8 !important;
    border: 1px solid #3a5f3a;
}

/* Copy button in dark mode */
[data-theme="dark"] .copy-fix-btn {
    background-color: #3a3a3a;
    color: #e0e0e0;
}

[data-theme="dark"] .copy-fix-btn:hover {
    background-color: var(--secondary-color);
    color: white;
}

/* Severity badges inside cards */
[data-theme="dark"] .error-severity {
    opacity: 0.9;
}

/* Expand icon */
[data-theme="dark"] .expand-icon {
    color: #adb5bd;
}

[data-theme="dark"] .expand-icon:hover {
    color: var(--primary-color);
    background-color: rgba(255, 255, 255, 0.1);
}

/* Subtle separator in expanded details */
[data-theme="dark"] .error-card.expanded .error-details {
    border-top-color: #444;
}

/* Multi-line fix warning text */
[data-theme="dark"] .suggested-fix div[style*="color: var(--warning-color)"] {
    color: #ffd43b !important;
}

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background-color: white;
            box-shadow: var(--box-shadow);
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            color: var(--primary-color);
            font-size: 28px;
        }

        .logo h1 {
            font-size: 24px;
            color: var(--primary-color);
        }

        .tagline {
            color: var(--gray-color);
            font-size: 14px;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .input-section, .output-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            height: fit-content;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: var(--secondary-color);
            border-bottom: 1px solid var(--light-gray);
            padding-bottom: 10px;
        }

        .section-title i {
            font-size: 20px;
        }

        /* Code Input Area */
        .code-input-container {
            margin-bottom: 20px;
        }

        .code-input {
            width: 100%;
            height: 350px;
            padding: 15px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-family: 'Courier New', monospace;
            font-size: 15px;
            resize: vertical;
            background-color: #fcfcfc;
            transition: var(--transition);
        }

        .code-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }

        .button-container {
            display: flex;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--light-gray);
            color: var(--dark-color);
        }

        .btn-secondary:hover {
            background-color: #dde1e7;
        }

        /* Output Section */
        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .issues-count {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .issues-badge {
            background-color: var(--light-gray);
            color: var(--dark-color);
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
        }

        .issues-badge.error {
            background-color: rgba(230, 57, 70, 0.1);
            color: var(--error-color);
        }

        .issues-badge.warning {
            background-color: rgba(255, 158, 0, 0.1);
            color: var(--warning-color);
        }

        .clear-btn {
            font-size: 14px;
            padding: 8px 16px;
        }

        .output-placeholder {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-color);
        }

        .output-placeholder i {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--light-gray);
        }

        /* Error Cards */
        .errors-container {
            max-height: 500px;
            overflow-y: auto;
        }

        .error-card {
            border-left: 4px solid var(--error-color);
            background-color: white;
            border-radius: var(--border-radius);
            padding: 18px;
            margin-bottom: 15px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            cursor: pointer;
        }

        .error-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }

        .error-card.warning {
            border-left-color: var(--warning-color);
        }

        .error-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .error-title {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .error-location {
            color: var(--gray-color);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .error-severity {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .severity-error {
            background-color: rgba(230, 57, 70, 0.1);
            color: var(--error-color);
        }

        .severity-warning {
            background-color: rgba(255, 158, 0, 0.1);
            color: var(--warning-color);
        }

        .error-explanation {
            color: var(--gray-color);
            font-size: 14px;
            margin-bottom: 15px;
        }

        .error-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .error-card.expanded .error-details {
            max-height: 500px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--light-gray);
        }

        .detail-section {
            margin-bottom: 15px;
        }

        .detail-title {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .suggested-fix, .detailed-explanation {
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: var(--border-radius);
            font-size: 14px;
            line-height: 1.5;
        }

        .example-code {
            background-color: #1e1e1e;
            color: #f8f8f2;
            padding: 15px;
            border-radius: var(--border-radius);
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }

        .code-keyword {
            color: #ff79c6;
        }

        .code-function {
            color: #50fa7b;
        }

        .code-string {
            color: #f1fa8c;
        }

        .code-comment {
            color: #6272a4;
        }

        /* Feedback Section */
        .feedback-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            margin-top: 30px;
        }

        .feedback-input {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 15px;
            resize: vertical;
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .feedback-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }

        .feedback-btn-container {
            display: flex;
            justify-content: flex-end;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--gray-color);
            font-size: 14px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .logo h1 {
                font-size: 20px;
            }
            
            .input-section, .output-section, .feedback-section {
                padding: 20px;
            }
            
            .code-input {
                height: 300px;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #5a6268;
        }
        /* Add these to your existing CSS */

/* Line numbers for code input */
/* Code Input Area - REPLACE THESE STYLES */
.code-input-container {
    display: flex;
    border: 1px solid var(--light-gray);
    border-radius: var(--border-radius);
    overflow: hidden;
    margin-bottom: 20px;
    background: #f5f5f5;
}

.line-numbers {
    width: 50px;
    background-color: #f5f5f5;
    padding: 15px 8px;
    font-family: 'Courier New', monospace;
    font-size: 15px;
    line-height: 21px;
    text-align: right;
    color: #666;
    overflow-y: scroll;
    overflow-x: hidden;
    scrollbar-width: none;
    border-right: 1px solid #ddd;
    flex-shrink: 0;
    user-select: none;
}

.line-numbers::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Edge */
}

.code-input {
    flex: 1;
    min-height: 350px;
    padding: 15px;
    border: none;
    border-radius: 0;
    font-family: 'Courier New', monospace;
    font-size: 15px;
    line-height: 21px;
    resize: vertical;
    background-color: #fcfcfc;
    transition: var(--transition);
    outline: none;
}
.code-input-with-lines {
    padding-left: 55px !important;
    background: linear-gradient(to right, #f5f5f5 0px, #f5f5f5 40px, #fcfcfc 40px, #fcfcfc 100%);
}

/* Highlighting for errors and warnings in the code */
.error-highlight {
    background-color: rgba(230, 57, 70, 0.2);
    border-bottom: 2px solid var(--error-color);
}

.warning-highlight {
    background-color: rgba(255, 158, 0, 0.2);
    border-bottom: 2px solid var(--warning-color);
}

/* Highlight effect when clicking error card */
.highlight-active {
    animation: pulseHighlight 1.5s;
}

@keyframes pulseHighlight {
    0% { background-color: rgba(67, 97, 238, 0.3); }
    50% { background-color: rgba(67, 97, 238, 0.6); }
    100% { background-color: rgba(67, 97, 238, 0.1); }
}

/* Simple highlight for active line */
.highlighted-line {
    background-color: rgba(67, 97, 238, 0.2) !important;
}

.expand-icon {
    color: var(--gray-color);
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
}

.expand-icon:hover {
    background-color: rgba(0, 0, 0, 0.05);
    color: var(--primary-color);
}

/* Add this to your CSS */
.card-clickable-area {
    cursor: pointer;
    transition: background-color 0.2s ease;
    border-radius: var(--border-radius);
    padding: 4px;
}

.card-clickable-area:hover {
    background-color: rgba(0, 0, 0, 0.2);
}

/* Add to your existing CSS */

/* Card clickable area - pointer cursor */
.card-clickable-area {
    cursor: pointer;
    transition: background-color 0.2s ease;
    border-radius: var(--border-radius);
    padding: 4px;
}

.card-clickable-area:hover {
    background-color: rgba(0, 0, 0, 0.02);
}

/* Expand icon - pointer cursor */
.expand-icon {
    cursor: pointer;
}

/* Fix code area - text cursor */
.fix-code {
    cursor: text !important;
    user-select: text !important;
    -webkit-user-select: text !important;
    -moz-user-select: text !important;
    -ms-user-select: text !important;
}

/* Make sure other parts of the card have default cursor */
.error-card {
    cursor: default; /* Default for entire card */
}

.error-card .suggested-fix,
.error-card .detailed-explanation,
.error-card .detail-title,
.error-card .detail-section {
    cursor: default; /* Default for all detail sections */
}

/* Only the clickable area should have pointer */
.error-card .card-clickable-area * {
    cursor: pointer; /* Everything inside clickable area is clickable */
}

/* But text inside should still be selectable */
.error-explanation {
    cursor: pointer; /* Clickable to expand */
    user-select: text; /* But also selectable */
    -webkit-user-select: text;
}

/* Copy button */
.copy-fix-btn {
    cursor: pointer !important;
    transition: background-color 0.2s ease !important;
}

.copy-fix-btn:hover {
    background-color: var(--secondary-color) !important;
}

/* Just these 4 rules */
.card-clickable-area { cursor: pointer; }
.wrong-code, .fix-code { cursor: text; }
.copy-fix-btn { cursor: pointer; }
.error-card { cursor: default; }

/* Spinner already exists, but let's add success animation */
.feedback-success {
    background-color: var(--success-color) !important;
    color: white !important;
    transform: scale(1.05);
}

.feedback-success i {
    animation: popIn 0.4s ease forwards;
}

@keyframes popIn {
    0% { transform: scale(0); opacity: 0; }
    60% { transform: scale(1.2); opacity: 1; }
    100% { transform: scale(1); }
}
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-bug"></i>
                    <div>
                        <h1>JS Debugger</h1>
                        <p class="tagline">A beginner-friendly JavaScript debugging tool</p>
                    </div>
                </div>
                <div class="issues-count">
                    <span class="issues-badge" id="errorCount">0 errors</span>
                    <span class="issues-badge warning" id="warningCount">0 warnings</span>
                </div>
                <button id="themeToggle" class="btn btn-secondary" title="Toggle dark/light mode">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <!-- Input Section -->
            <section class="input-section">
                <h2 class="section-title">
                    <i class="fas fa-code"></i>
                    Your JavaScript Code
                </h2>
                <div class="code-input-container">
                    <div id="lineNumbers" class="line-numbers">1</div>
<textarea id="codeInput" class="code-input" placeholder="Paste your JavaScript code here..."></textarea>
                </div>
                <div class="button-container">
                    <button id="analyzeBtn" class="btn btn-primary">
                        <i class="fas fa-play-circle"></i>
                        Analyze Code
                    </button>
                </div>
            </section>

            <!-- Output Section -->
            <section class="output-section">
                <div class="output-header">
                    <h2 class="section-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        Analysis Results
                    </h2>
                    <button id="clearBtn" class="btn btn-secondary clear-btn">
                        <i class="fas fa-trash-alt"></i>
                        Clear Results
                    </button>
                </div>
                
                <div id="outputContainer">
                    <!-- Placeholder when no analysis has been run -->
                    <div class="output-placeholder" id="outputPlaceholder">
                        <i class="fas fa-search"></i>
                        <h3>No analysis results yet</h3>
                        <p>Click "Analyze Code" to check your JavaScript for errors and warnings.</p>
                    </div>
                    
                    <!-- Error cards will be inserted here -->
                    <div id="errorsContainer" class="errors-container" style="display: none;"></div>
                </div>
            </section>
        </div>

        <!-- Feedback Section -->
        <section class="feedback-section">
            <h2 class="section-title">
                <i class="fas fa-comment-dots"></i>
                Send Feedback
            </h2>
            <p style="margin-bottom: 15px; color: var(--gray-color);">
                Help us improve this tool! Share your suggestions, report issues, or tell us what you like.
            </p>
            <textarea id="feedbackInput" class="feedback-input" placeholder="Type your feedback here..."></textarea>
            <div class="feedback-btn-container">
                <button id="submitFeedbackBtn" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i>
                    Submit Feedback
                </button>
            </div>
        </section>

        <footer>
            <p>JS Debugger MVP &copy; 2026 | A lightweight JavaScript debugging tool for beginners</p>
        </footer>
    </div>

    <!-- Include Acorn parser from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/acorn/8.9.0/acorn.min.js"></script>
    
    <script>
        // DOM Elements
        const codeInput = document.getElementById('codeInput');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const clearBtn = document.getElementById('clearBtn');
        const outputPlaceholder = document.getElementById('outputPlaceholder');
        const errorsContainer = document.getElementById('errorsContainer');
        const errorCountElement = document.getElementById('errorCount');
        const warningCountElement = document.getElementById('warningCount');
        const feedbackInput = document.getElementById('feedbackInput');
        const submitFeedbackBtn = document.getElementById('submitFeedbackBtn');


// COMPLETE issuesDatabase with getFix functions for all detectors
const issuesDatabase = {
    'SyntaxError': {
        title: 'Syntax Error',
        explanation: 'JavaScript cannot read this line because something is typed wrong.',
        details: 'The code breaks basic JavaScript rules.',
        getFix: function(lineText, lineNumber) {
            return 'Fix the typo. Look for missing or extra symbols like ), }, ], or ;.';
        }
    },
    'MissingSemicolon': {
        title: 'Missing Semicolon',
        severity: 'warning',
        explanation: 'You forgot a semicolon at the end of the line.',
        details: 'JavaScript sometimes adds semicolons for you, but not always.',
        getFix: function(lineText) {
            const trimmed = lineText.trim();
            if (trimmed && !trimmed.endsWith(';') && !trimmed.endsWith('{') && !trimmed.endsWith('}')) {
                return trimmed + ';';
            }
            return 'Add a semicolon at the end.';
        }
    },
    'UndefinedVariable': {
        title: 'Undefined Variable',
        explanation: 'You used a variable that was never created.',
        details: 'You must make a variable before using it.',
        getFix: function(lineText, lineNumber) {
            const varMatch = lineText.match(/\b([a-zA-Z_$][a-zA-Z0-9_$]*)\b/);
            if (varMatch) {
                const varName = varMatch[1];
                return `Add before line ${lineNumber}: let ${varName};`;
            }
            return 'Create the variable before using it.';
        }
    },
    'UnusedVariable': {
        title: 'Unused Variable',
        severity: 'warning',
        explanation: 'You made a variable but never used it.',
        details: 'Unused variables just take up space.',
        getFix: function(lineText) {
            const varMatch = lineText.match(/(?:let|const|var)\s+(\w+)/);
            if (varMatch) {
                const varName = varMatch[1];
                return `Remove this line or use ${varName}.`;
            }
            return 'Remove it or use it.';
        }
    },
    'AssignmentInCondition': {
        title: 'Assignment in Condition',
        severity: 'warning',
        explanation: 'You used = inside an if/while, which sets a value instead of comparing.',
        details: 'You probably meant to compare values, not assign them.',
        getFix: function(lineText) {
            return lineText.replace(/if\s*\(([^)=]+)=([^)]+)\)/, 'if ($1===$2)')
                          .replace(/while\s*\(([^)=]+)=([^)]+)\)/, 'while ($1===$2)');
        }
    },
    'DuplicateParameter': {
        title: 'Duplicate Parameter Name',
        explanation: 'A function has two parameters with the same name.',
        details: 'This confuses JavaScript.',
        getFix: function(lineText) {
            const paramMatch = lineText.match(/function\s+\w+\s*\(([^)]*)\)/);
            if (paramMatch) {
                const params = paramMatch[1].split(',').map(p => p.trim());
                const uniqueParams = [...new Set(params)];
                if (params.length !== uniqueParams.length) {
                    const newParams = params.map((p, i) => {
                        if (params.indexOf(p) !== i) return p + i;
                        return p;
                    });
                    return lineText.replace(paramMatch[1], newParams.join(', '));
                }
            }
            return 'Use different parameter names.';
        }
    },
    'VarUsage': {
        title: 'Using var Instead of let/const',
        severity: 'warning',
        explanation: 'You used var, which is old and can cause weird bugs.',
        details: 'Use let or const instead.',
        getFix: function(lineText) {
            const isLikelyConstant = lineText.toLowerCase().includes('const') || 
                                   lineText.match(/[A-Z_]+/) ||
                                   lineText.includes('PI') || lineText.includes('MAX') || 
                                   lineText.includes('MIN') || lineText.includes('DEFAULT');
            return lineText.replace('var ', isLikelyConstant ? 'const ' : 'let ');
        }
    },
    'EqualityOperator': {
        title: 'Loose Equality Operator',
        severity: 'warning',
        explanation: 'You used == instead of ===.',
        details: '== guesses types and can cause bugs.',
        getFix: function(lineText) {
            return lineText.replace(/==/g, '===').replace(/!=/g, '!==');
        }
    },
    'ConstReassignment': {
        title: 'Reassigning a Constant',
        severity: 'error',
        explanation: 'You tried to change a const variable.',
        details: 'const variables cannot change.',
        getFix: function(lineText, lineNumber) {
            const varMatch = lineText.match(/^\s*(\w+)\s*=/);
            if (varMatch) {
                const varName = varMatch[1];
                return `Change const to let for ${varName} where it was declared.`;
            }
            return 'Change const to let for this variable.';
        }
    },
    'StringConcatenationError': {
        title: 'String/Number Mix-Up',
        severity: 'warning',
        explanation: 'You mixed strings and numbers with +.',
        details: 'JavaScript thinks you want to join text, not add numbers.',
        getFix: function(lineText) {
            return lineText.replace(/"(\d+)"\s*\+\s*(\d+)/g, '(Number("$1") + $2)')
                          .replace(/(\d+)\s*\+\s*"(\d+)"/g, '($1 + Number("$2"))');
        }
    },
    'GlobalVariableLeak': {
        title: 'Global Variable Leak',
        severity: 'warning',
        explanation: 'You made a variable without let/const/var.',
        details: 'JavaScript then makes it global by accident.',
        getFix: function(lineText) {
            const varMatch = lineText.match(/^\s*(\w+)\s*=/);
            if (varMatch) {
                const varName = varMatch[1];
                return lineText.replace(/^\s*(\w+)\s*=/, `let ${varName} =`);
            }
            return 'Add let, const, or var before the name.';
        }
    },
    'MissingFunctionParentheses': {
        title: 'Missing Function Call Parentheses',
        severity: 'error',
        explanation: 'You wrote a function name but forgot the ().',
        details: 'Without (), the function does not run.',
        getFix: function(lineText) {
            const funcMatch = lineText.match(/(\w+)(?:\s*;?)$/);
            if (funcMatch && !lineText.includes('(')) {
                return lineText.replace(/(\w+)(?:\s*;?)$/, '$1();');
            }
            return 'Add () after the function name.';
        }
    },
    'TruthyFalsyConfusion': {
        title: 'Truthy/Falsy Confusion',
        severity: 'warning',
        explanation: 'You used a value in an if without checking it properly.',
        details: 'Some values count as false even if they donâ€™t look false.',
        getFix: function(lineText) {
            const varMatch = lineText.match(/if\s*\(\s*(\w+)\s*\)/);
            if (varMatch) {
                const varName = varMatch[1];
                return lineText.replace(/if\s*\(\s*\w+\s*\)/, `if (${varName} !== 0)`);
            }
            return 'Use a clear comparison instead of relying on truthiness.';
        }
    },
    'NaNComparison': {
        title: 'Comparing with NaN',
        severity: 'warning',
        explanation: 'You tried to compare something to NaN.',
        details: 'NaN is never equal to anything, not even itself.',
        getFix: function(lineText) {
            return lineText.replace(/(\w+)\s*(===|==)\s*NaN/g, 'Number.isNaN($1)')
                          .replace(/NaN\s*(===|==)\s*(\w+)/g, 'Number.isNaN($2)');
        }
    },
    'UnreachableCode': {
        title: 'Unreachable Code',
        severity: 'warning',
        explanation: 'You wrote code after a return. It will never run.',
        details: 'return stops the function immediately.',
        getFix: function(lineText, lineNumber) {
            return `Move this code before the return on line ${lineNumber - 1}, or remove the return.`;
        }
    },
    'InfiniteLoop': {
        title: 'Infinite Loop Risk',
        severity: 'warning',
        explanation: 'Your loop might never stop.',
        details: 'The condition may never change.',
        getFix: function(lineText) {
            if (lineText.includes('while (')) {
                return `${lineText}\n  // Add something inside the loop that changes the condition`;
            } else if (lineText.includes('for (')) {
                if (!lineText.includes('; i++)') && !lineText.includes('; i--') && 
                    !lineText.includes('; i +=') && !lineText.includes('; i -=')) {
                    return lineText.replace(/\)$/, '; i++)');
                }
            }
            return 'Make sure the loop condition eventually becomes false.';
        }
    },
    'ForLoopSemicolon': {
        title: 'For Loop Semicolon Error',
        severity: 'error',
        explanation: 'You used commas instead of semicolons in a for loop.',
        details: 'for loops must use semicolons.',
        getFix: function(lineText) {
            return lineText.replace(/for\s*\(([^,]+),([^,]+),([^)]+)\)/, 'for ($1; $2; $3)');
        }
    },
    'VariableShadowing': {
        title: 'Variable Shadowing',
        severity: 'warning',
        explanation: 'You made a variable with the same name as another one.',
        details: 'The new one hides the old one.',
        getFix: function(lineText) {
            const varMatch = lineText.match(/(?:let|const|var)\s+(\w+)/);
            if (varMatch) {
                const varName = varMatch[1];
                return `Use a different name instead of ${varName}.`;
            }
            return 'Use a different variable name.';
        }
    },
    'AsyncWithoutAwait': {
        title: 'Async Function Without Await',
        severity: 'warning',
        explanation: 'You made a function async but never used await.',
        details: 'Then there is no reason for it to be async.',
        getFix: function(lineText) {
            if (lineText.includes('async function') && !lineText.includes('await')) {
                return lineText.replace('async ', '');
            }
            return 'Remove async or add await.';
        }
    },
    'ReturnNewLine': {
        title: 'Automatic Semicolon Insertion with Return',
        severity: 'warning',
        explanation: 'You put the return value on the next line.',
        details: 'JavaScript thinks you meant return; with nothing.',
        getFix: function(lineText, lineNumber) {
            return `Put the return value on the same line as return on line ${lineNumber}.`;
        }
    },
    'MisplacedBreakContinue': {
        title: 'Misplaced Break/Continue',
        severity: 'error',
        explanation: 'You used break or continue outside a loop or switch.',
        details: 'They only work inside loops or switch statements.',
        getFix: function(lineText) {
            return 'Remove break/continue or move it inside a loop.';
        }
    }
};

        // ==================== LINE NUMBER FUNCTIONS ====================
        function updateLineNumbers() {
            const codeInput = document.getElementById('codeInput');
            const lineNumbers = document.getElementById('lineNumbers');
            
            if (!lineNumbers) return;
            
            const lines = codeInput.value.split('\n');
            const lineCount = lines.length;
            
            // Generate line numbers
            let lineNumbersHTML = '';
            for (let i = 1; i <= lineCount; i++) {
                lineNumbersHTML += i + '<br>';
            }
            
            lineNumbers.innerHTML = lineNumbersHTML;
            lineNumbers.style.height = codeInput.clientHeight + 'px';
        }

        function highlightLineInEditor(lineNumber) {
            const lineNumbers = document.getElementById('lineNumbers');
            if (!lineNumbers) return;
            
            const lines = lineNumbers.innerHTML.split('<br>');
            lines.pop(); // Remove last empty element
            
            // Clear previous highlights
            for (let i = 0; i < lines.length; i++) {
                lines[i] = lines[i].replace(/<span[^>]*>/g, '').replace(/<\/span>/g, '');
            }
            
            // Add highlight to the clicked line
            if (lineNumber - 1 < lines.length) {
                lines[lineNumber - 1] = `<span style="background-color: rgba(67, 97, 238, 0.3); padding: 0 5px; border-radius: 3px;">${lineNumber}</span>`;
                lineNumbers.innerHTML = lines.join('<br>');
                
                // Scroll to that line in the editor
                const codeInput = document.getElementById('codeInput');
                const lineHeight = 20;
                codeInput.scrollTop = Math.max(0, (lineNumber - 3) * lineHeight);
                codeInput.focus();
            }
        }
        // ==================== END LINE NUMBER FUNCTIONS ====================

        // Initialize the application
        function init() {
            // Set up event listeners
            analyzeBtn.addEventListener('click', analyzeCode);
            clearBtn.addEventListener('click', clearResults);
            submitFeedbackBtn.addEventListener('click', submitFeedback);
            
            // Make Enter key submit feedback (with Ctrl/Cmd)
            feedbackInput.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    submitFeedback();
                }
            });
            
            // Set up line number events
            codeInput.addEventListener('input', updateLineNumbers);
            codeInput.addEventListener('scroll', function() {
                const lineNumbers = document.getElementById('lineNumbers');
                if (lineNumbers) {
                    lineNumbers.scrollTop = this.scrollTop;
                }
            });
            
            // Initialize line numbers
            updateLineNumbers();
            
            // Analyze the example code on page load
            setTimeout(() => {
                analyzeCode();
            }, 500);
        }

        // Main function to analyze the JavaScript code
// Main function to analyze the JavaScript code
function analyzeCode() {
    const code = codeInput.value.trim();
    
    // Clear previous results but keep placeholder hidden if we have code
    clearResults(code !== '');
    
    // If code is empty, show appropriate message
    if (code === '') {
        displayIssues([]); // This will show the "no analysis yet" message
        return;
    }
    
    // Hide placeholder and show errors container
    outputPlaceholder.style.display = 'none';
    errorsContainer.style.display = 'block';
    
    // Parse and analyze the code
    const issues = parseAndAnalyze(code);
    
    // Display the issues
    displayIssues(issues);
    
    // Update issue counts
    updateIssueCounts(issues);
    
    // Update line numbers
    updateLineNumbers();
}

        // Parse code using Acorn and analyze for issues
        function parseAndAnalyze(code) {
            const issues = [];
            
            // Try to parse the code with Acorn
            try {
                acorn.parse(code, { ecmaVersion: 'latest' });
                checkForIssues(code, issues);
            } catch (error) {
                const lineMatch = error.message.match(/\((\d+):(\d+)\)/);
                let line = 1;
                if (lineMatch) {
                    line = parseInt(lineMatch[1]);
                }
                
                issues.push({
                    type: 'SyntaxError',
                    line: line,
                    message: error.message,
                    severity: 'error'
                });
                
                checkForIssues(code, issues, line);
            }
            
            return issues;
        }

        // Check for common issues in the code
        function checkForIssues(code, issues, maxLine = null) {
            const lines = code.split('\n');
            
            for (let i = 0; i < lines.length; i++) {
                if (maxLine && i >= maxLine - 1) break;
                
                const lineNumber = i + 1;
                const line = lines[i];
                
                // Check for missing semicolons
                if (line.trim() && !line.trim().startsWith('//') && 
                    !line.trim().startsWith('*') && !line.trim().startsWith('/*') &&
                    !line.includes('{') && !line.includes('}') &&
                    !line.trim().endsWith(';') && !line.trim().endsWith('{') && 
                    !line.trim().endsWith('}') && !line.includes('if') &&
                    !line.includes('for') && !line.includes('while') &&
                    !line.includes('function') && line.trim()) {
                    
                    issues.push({
                        type: 'MissingSemicolon',
                        line: lineNumber,
                        message: 'Missing semicolon at the end of statement',
                        severity: 'warning'
                    });
                }
                
                // Check for undefined variables
                if (line.includes('undefinedVariable')) {
                    issues.push({
                        type: 'UndefinedVariable',
                        line: lineNumber,
                        message: 'undefinedVariable is not defined',
                        severity: 'error'
                    });
                }
                
                // Check for unused variables
                if (line.includes('let unused') || line.includes('const unused') || line.includes('var unused')) {
                    issues.push({
                        type: 'UnusedVariable',
                        line: lineNumber,
                        message: 'Variable declared but never used',
                        severity: 'warning'
                    });
                }
                
                // Check for assignment in condition
                if ((line.includes('if (') || line.includes('while (')) && 
                    line.includes(' = ') && line.includes(' = null') && !line.includes(' === ') && !line.includes(' == ')) {
                    
                    issues.push({
                        type: 'AssignmentInCondition',
                        line: lineNumber,
                        message: 'Assignment instead of comparison in condition',
                        severity: 'warning'
                    });
                }
                
                // Check for duplicate parameters
                if (line.includes('function') && line.includes('(') && line.includes(')')) {
                    const paramMatch = line.match(/function\s+\w+\s*\((.*)\)/);
                    if (paramMatch) {
                        const params = paramMatch[1].split(',').map(p => p.trim());
                        const uniqueParams = [...new Set(params)];
                        if (params.length !== uniqueParams.length) {
                            issues.push({
                                type: 'DuplicateParameter',
                                line: lineNumber,
                                message: 'Duplicate parameter names in function definition',
                                severity: 'error'
                            });
                        }
                    }
                }
            }
            
            return issues;
        }
// Display issues as error cards - UPDATED VERSION
function displayIssues(issues) {
    errorsContainer.innerHTML = '';
    
    // Get the current code lines
    const codeLines = codeInput.value.split('\n');
    
    // Sort issues by line number
    issues.sort((a, b) => a.line - b.line);
    
    // Create error card for each issue
    issues.forEach(issue => {
        const errorCard = createErrorCard(issue, codeLines);
        errorsContainer.appendChild(errorCard);
    });
    
    // If no issues found AND we actually analyzed code (not empty)
    if (issues.length === 0 && codeInput.value.trim() !== '') {
        errorsContainer.innerHTML = `
            <div class="output-placeholder">
                <i class="fas fa-check-circle" style="color: var(--success-color);"></i>
                <h3>No issues found!</h3>
                <p>Your JavaScript code appears to be free of syntax errors and common issues.</p>
            </div>
        `;
    } else if (issues.length === 0 && codeInput.value.trim() === '') {
        // If code is empty, show the original placeholder
        errorsContainer.style.display = 'none';
        outputPlaceholder.style.display = 'block';
        outputPlaceholder.innerHTML = `
            <i class="fas fa-search"></i>
            <h3>No analysis results yet</h3>
            <p>Click "Analyze Code" to check your JavaScript for errors and warnings.</p>
        `;
    }
}
// Create an error card element - WITH COPY FUNCTIONALITY
// Create an error card element - CLEANER VERSION
function createErrorCard(issue, codeLines) {
    const issueInfo = issuesDatabase[issue.type] || {
        title: issue.type,
        explanation: issue.message,
        details: 'No additional details available.',
        fix: 'Review the code at the indicated line.',
        example: '',
        severity: issue.severity || 'error'
    };
    
    const severity = issueInfo.severity || issue.severity || 'error';
    const severityClass = severity === 'error' ? 'severity-error' : 'severity-warning';
    
    // Get the actual line of code
    const lineText = codeLines[issue.line - 1] || '';
    
    // Generate line-specific fix if getFix function exists
    let specificFix = issueInfo.fixTemplate || 'Review the code.';
    if (issueInfo.getFix && typeof issueInfo.getFix === 'function') {
        try {
            specificFix = issueInfo.getFix(lineText, issue.line);
        } catch (e) {
            specificFix = issueInfo.fixTemplate || 'Review the code.';
        }
    }
    
    const errorCard = document.createElement('div');
    errorCard.className = `error-card ${severity === 'warning' ? 'warning' : ''}`;
    errorCard.innerHTML = `
    <div class="card-clickable-area">
        <div class="error-card-header">
            <div>
                <div class="error-title">${issueInfo.title}</div>
                <div class="error-location">
                    <i class="fas fa-file-code"></i>
                    Line ${issue.line}
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span class="error-severity ${severityClass}">${severity.toUpperCase()}</span>
                <span class="expand-icon" title="Expand/Collapse">
                    <i class="fas fa-chevron-down"></i>
                </span>
            </div>
        </div>
        <div class="error-explanation">${issueInfo.explanation}</div>
    </div>
    <div class="error-details">
        <div class="detail-section">
            <div class="detail-title">
                <i class="fas fa-info-circle"></i>
                Detailed Explanation
            </div>
            <div class="detailed-explanation">${issueInfo.details}</div>
        </div>
        <div class="detail-section">
            <div class="detail-title">
                <i class="fas fa-wrench"></i>
                Suggested Fix for Line ${issue.line}
            </div>
            <div class="suggested-fix">
                <div style="margin-bottom: 8px; color: var(--gray-color); font-size: 14px;">
                    <strong>Your code:</strong>
                </div>
                <div style="background-color: #1e1e1e; color: #f8f8f2; padding: 10px; border-radius: 4px; font-family: 'Courier New', monospace; margin-bottom: 10px;">
                    ${escapeHtml(lineText.trim() || '(empty line)')}
                </div>
                <div style="margin-bottom: 8px; color: var(--gray-color); font-size: 14px;">
                    <strong>Fix:</strong>
                    <button class="copy-fix-btn" style="margin-left: 10px; background: var(--primary-color); color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;">
                        <i class="fas fa-copy"></i> Copy Fix
                    </button>
                </div>
                <div class="fix-code" style="background-color: #1e1e1e; color: #50fa7b; padding: 10px; border-radius: 4px; font-family: 'Courier New', monospace; position: relative;">
                    ${escapeHtml(specificFix)}
                    <div class="copy-hint" style="position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px; opacity: 0; transition: opacity 0.2s;">
                        Click to copy
                    </div>
                </div>
                ${specificFix.includes('\n') ? 
                `<div style="margin-top: 8px; font-size: 13px; color: var(--warning-color);">
                    <i class="fas fa-lightbulb"></i> Multiple lines shown - implement all changes
                </div>` : ''}
            </div>
        </div>
    </div>
`;

    // Get references to elements
    const cardClickableArea = errorCard.querySelector('.card-clickable-area');
    const expandIcon = errorCard.querySelector('.expand-icon');
    const chevron = expandIcon.querySelector('i');
    const wrongCodeElement = errorCard.querySelector('.wrong-code');
    const fixCodeElement = errorCard.querySelector('.fix-code');
    const copyFixBtn = errorCard.querySelector('.copy-fix-btn');
    
    // Function to toggle card
    function toggleCard() {
        const isExpanding = !errorCard.classList.contains('expanded');
        
        errorCard.classList.toggle('expanded');
        
        // Update chevron
        if (errorCard.classList.contains('expanded')) {
            chevron.className = 'fas fa-chevron-up';
        } else {
            chevron.className = 'fas fa-chevron-down';
        }
        
        // Highlight the line in editor when expanding
        if (isExpanding) {
            highlightLineInEditor(issue.line);
        }
    }
    
    // Make ENTIRE CLICKABLE AREA (header + explanation) clickable
    cardClickableArea.addEventListener('click', function(e) {
        // Only toggle if not clicking on the expand icon itself
        if (!e.target.closest('.expand-icon')) {
            toggleCard();
        }
    });
    
    // Make expand icon clickable
    expandIcon.addEventListener('click', function(e) {
        toggleCard();
        e.stopPropagation();
    });
    
    // Make WRONG CODE text selectable (I-beam cursor)
    if (wrongCodeElement) {
        wrongCodeElement.style.cursor = 'text';
        wrongCodeElement.style.userSelect = 'text';
        wrongCodeElement.style.webkitUserSelect = 'text';
    }
    
    // Make FIX CODE text selectable (I-beam cursor)
    // COPY FUNCTIONALITY
if (fixCodeElement) {
    // Show copy hint on hover
    fixCodeElement.addEventListener('mouseenter', function() {
        if (copyHint) copyHint.style.opacity = '1';
    });
    
    fixCodeElement.addEventListener('mouseleave', function() {
        if (copyHint) copyHint.style.opacity = '0';
    });
    
    // Copy on click
    fixCodeElement.addEventListener('click', function(e) {
        e.stopPropagation(); // Don't bubble to header
        
        // Extract text content (without HTML)
        const textToCopy = this.textContent || this.innerText;
        
        // Copy to clipboard
        navigator.clipboard.writeText(textToCopy).then(() => {
            // Show feedback
            const originalHint = copyHint.textContent;
            copyHint.textContent = 'Copied!';
            copyHint.style.backgroundColor = 'var(--success-color)';
            
            setTimeout(() => {
                copyHint.textContent = originalHint;
                copyHint.style.backgroundColor = 'rgba(0,0,0,0.7)';
            }, 1500);
        });
    });
    
    // Make it look selectable
    fixCodeElement.style.cursor = 'text';
    fixCodeElement.style.userSelect = 'text';
    fixCodeElement.style.webkitUserSelect = 'text';
    fixCodeElement.style.mozUserSelect = 'text';
    fixCodeElement.style.msUserSelect = 'text';
}

// Copy button functionality
if (copyFixBtn) {
    copyFixBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        
        const textToCopy = specificFix.replace(/<br>/g, '\n').replace(/<[^>]*>/g, '');
        
        navigator.clipboard.writeText(textToCopy).then(() => {
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-check"></i> Copied!';
            this.style.backgroundColor = 'var(--success-color)';
            
            setTimeout(() => {
                this.innerHTML = originalText;
                this.style.backgroundColor = 'var(--primary-color)';
            }, 1500);
        });
    });
}
    
    // Prevent clicks inside the details from closing the card
    const detailsSection = errorCard.querySelector('.error-details');
    if (detailsSection) {
        detailsSection.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }
    
    return errorCard;
}
// Helper function to escape HTML
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML.replace(/\n/g, '<br>');
}

        // Update the error and warning counts
        function updateIssueCounts(issues) {
            const errorCount = issues.filter(issue => 
                (issue.severity === 'error' || 
                (issuesDatabase[issue.type] && issuesDatabase[issue.type].severity === 'error'))
            ).length;
            
            const warningCount = issues.filter(issue => 
                (issue.severity === 'warning' || 
                (issuesDatabase[issue.type] && issuesDatabase[issue.type].severity === 'warning'))
            ).length;
            
            errorCountElement.textContent = `${errorCount} ${errorCount === 1 ? 'error' : 'errors'}`;
            errorCountElement.className = `issues-badge ${errorCount > 0 ? 'error' : ''}`;
            
            warningCountElement.textContent = `${warningCount} ${warningCount === 1 ? 'warning' : 'warnings'}`;
            warningCountElement.className = `issues-badge warning`;
        }

        // Clear the analysis results
        function clearResults(keepPlaceholderHidden = false) {
            errorsContainer.innerHTML = '';
            errorsContainer.style.display = 'none';
            
            if (!keepPlaceholderHidden) {
                outputPlaceholder.style.display = 'block';
            }
            
            // Reset counts
            errorCountElement.textContent = '0 errors';
            errorCountElement.className = 'issues-badge';
            warningCountElement.textContent = '0 warnings';
            warningCountElement.className = 'issues-badge warning';
            
            // Clear line number highlights
            const lineNumbers = document.getElementById('lineNumbers');
            if (lineNumbers) {
                const lines = lineNumbers.innerHTML.split('<br>');
                for (let i = 0; i < lines.length; i++) {
                    lines[i] = lines[i].replace(/<span[^>]*>/g, '').replace(/<\/span>/g, '');
                }
                lineNumbers.innerHTML = lines.join('<br>');
            }
        }

        // Submit feedback (for now, just logs to console)
        function submitFeedback() {
    const feedback = feedbackInput.value.trim();
    if (!feedback) return;

    const googleFormURL =
        'https://docs.google.com/forms/d/e/1FAIpQLSd6fgVCev9CyTZTufb36ZoY77vDVb7jpegANQD0B7UiASRMeA/formResponse';

    const formData = new FormData();
    formData.append('entry.1169807996', feedback);

    // Save original button text
    const originalBtnText = submitFeedbackBtn.innerHTML;

    // Show spinner
    submitFeedbackBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
    submitFeedbackBtn.disabled = true;

    fetch(googleFormURL, {
        method: 'POST',
        mode: 'no-cors',
        body: formData
    })
    .then(() => {
        // Success animation
        submitFeedbackBtn.classList.add('feedback-success');
        submitFeedbackBtn.innerHTML = '<i class="fas fa-check"></i> Sent!';

        // Clear input
        feedbackInput.value = '';

        // Reset after animation
        setTimeout(() => {
            submitFeedbackBtn.classList.remove('feedback-success');
            submitFeedbackBtn.innerHTML = originalBtnText;
            submitFeedbackBtn.disabled = false;
        }, 1500);
    })
    .catch(() => {
        // Even in no-cors, errors rarely fire, but just in case:
        submitFeedbackBtn.innerHTML = 'Error';
        setTimeout(() => {
            submitFeedbackBtn.innerHTML = originalBtnText;
            submitFeedbackBtn.disabled = false;
        }, 1500);
    });
}

// Theme toggle functionality
const themeToggle = document.getElementById('themeToggle');
const body = document.body;

// Load saved theme or default to dark
const savedTheme = localStorage.getItem('theme') || 'dark';
body.setAttribute('data-theme', savedTheme);

if (savedTheme === 'dark') {
    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
} else {
    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
}

themeToggle.addEventListener('click', () => {
    if (body.getAttribute('data-theme') === 'dark') {
        body.setAttribute('data-theme', 'light');
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        localStorage.setItem('theme', 'light');
    } else {
        body.setAttribute('data-theme', 'dark');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        localStorage.setItem('theme', 'dark');
    }
});

// At the very bottom of your <script> tag
    console.log('Script loaded');
init();
console.log('Init called');


    </script>
</body>

</html>
